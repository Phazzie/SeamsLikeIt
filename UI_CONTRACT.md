# UI Contract

This document defines the seam between the SeamsLikeIt frontend and backend. It serves as the formal contract for all communication between the two systems.

## 1. Data Structures

The frontend will consume the following primary data structures from the backend. All other types are nested within these.

*   **`ProposedPlan`**: The core plan object generated by an AI.
*   **`AgreementAnalysis`**: The result of comparing two plans.
*   **`SteelmanArgument`**: The result of a steelman argument.
*   **`SynthesizedPlan`**: The result of merging two plans.
*   **`CollaborationSession`**: The top-level object that tracks the entire collaboration process.

*Note: The full TypeScript definitions for these types are the single source of truth and are located in `src/types/collaboration.ts` and `src/types/sdd.ts`.*

## 2. API Endpoints (RESTful Seam)

The frontend will interact with the backend via the following RESTful endpoints.

### Authentication

*   **`POST /auth/login`**: Authenticates the user.
    *   **Request Body:** `{ username, password }`
    *   **Response Body:** `{ success, token, expiresIn }`

### Collaboration Tools

*   **`POST /tools/seam_propose_plan`**: Generates a new plan.
    *   **Request Body:** `{ requirements, aiId, domain }`
    *   **Response Body:** `{ success, plan: ProposedPlan }` or `{ success: false, error, details }`

*   **`POST /tools/seam_compare_plans`**: Compares two plans.
    *   **Request Body:** `{ planA: ProposedPlan, planB: ProposedPlan }`
    *   **Response Body:** `{ success, analysis: AgreementAnalysis }`

*   **`POST /tools/seam_steelman_argument`**: Generates a steelman argument.
    *   **Request Body:** `{ targetPlan: ProposedPlan, arguingAiId, focusAreas }`
    *   **Response Body:** `{ success, argument: SteelmanArgument }`

*   **`POST /tools/seam_synthesize_plans`**: Synthesizes two plans.
    *   **Request Body:** `{ planA, planB, steelmanA, steelmanB, synthesisStrategy }`
    *   **Response Body:** `{ success, plan: SynthesizedPlan }`

## 3. WebSocket Events (Real-time Seam)

The frontend will connect to a WebSocket server at `/ws` to receive real-time updates.

### Frontend Emits:

*   `start_collaboration`: Initiates a new collaboration session.
    *   **Payload:** `{ requirements, domain }`

### Backend Emits:

*   `collaboration_started`: Confirms the session has started.
    *   **Payload:** `{ sessionId }`
*   `plan_proposed`: Sent when an AI has generated a plan.
    *   **Payload:** `{ plan: ProposedPlan }`
*   `comparison_complete`: Sent when the plan comparison is finished.
    *   **Payload:** `{ analysis: AgreementAnalysis }`
*   `synthesis_complete`: Sent when the plan synthesis is finished.
    *   **Payload:** `{ plan: SynthesizedPlan }`
*   `progress_update`: Provides a generic progress update for long-running tasks.
    *   **Payload:** `{ message, percentComplete }`
*   `error_occurred`: Sent when an error occurs on the backend.
    *   **Payload:** `{ error, message }`

## 4. Error Handling

All API responses will return a `200 OK` and include a `success` boolean. If `success` is `false`, the response will include an `error` code and a user-friendly `message`.

WebSocket errors will be sent via the `error_occurred` event.